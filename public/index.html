<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T·ª∑ Ph√∫ B·∫ßu Tr·ªùi</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background-color: #0f0f1a;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #0f0f1a;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease-out;
        }

        #loading-screen.hidden-load {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <!-- LOADING SCREEN -->
    <div id="loading-screen" class="fixed inset-0 bg-[#0f0f1a] z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="relative w-24 h-24 flex items-center justify-center mb-6">
            <div class="absolute inset-0 border-4 border-blue-500/30 rounded-full animate-ping-slow"></div>
            <div class="text-6xl animate-bounce">‚úàÔ∏è</div>
        </div>
        <div class="text-yellow-400 font-bold text-2xl tracking-widest">T·ª∂ PH√ö B·∫¶U TR·ªúI</div>
        <div class="text-gray-500 text-sm mt-2 flex items-center gap-1">
            <span>Loading</span>
            <span class="animate-pulse">...</span>
        </div>
        <div class="w-48 h-1 bg-gray-800 rounded-full mt-6 overflow-hidden">
            <div class="h-full bg-blue-500 w-1/2 animate-[spin-slow_2s_linear_infinite]" style="width: 100%; transform-origin: left;"></div>
        </div>
    </div>

    <div class="absolute top-0 left-0 w-full h-full z-0 overflow-hidden pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[60%] h-[60%] bg-blue-900/10 blur-[120px] rounded-full"></div>
    </div>

    <div class="z-10 flex flex-col h-full w-full max-w-lg mx-auto bg-black/20 border-x border-white/5 h-screen relative">

        <!-- ================= HEADER WRAPPER (FIX D√çNH TOP) ================= -->
        <div class="pt-4 px-4 pb-2 z-20 relative flex-shrink-0">

            <!-- HEADER -->
            <div class="flex items-center mb-4">
                <!-- LEFT -->
                <div class="flex items-center gap-2 bg-[#2d2d3e]/80 py-1 px-3 rounded-full border border-white/10">
                    <span class="text-xl">‚úàÔ∏è</span>
                    <span class="text-sm font-bold">T·ª∑ Ph√∫ B·∫ßu Tr·ªùi</span>
                </div>

                <!-- RIGHT -->
                <div class="ml-auto flex items-center gap-2">
                    <div
                        id="mini-diamond"
                        data-ready="false"
                        class="hidden items-center gap-2 bg-black/40 px-3 py-1 rounded-full border border-white/10">
                        <span class="text-lg">üíé</span>
                        <span id="mini-diamond-text" class="text-sm font-bold text-blue-400">0</span>
                    </div>

                    <div
                        id="mini-balance"
                        data-ready="false"
                        class="hidden items-center gap-2 bg-black/40 px-3 py-1 rounded-full border border-white/10">
                        <span class="text-lg">üí∞</span>
                        <span id="mini-balance-text" class="text-sm font-bold text-yellow-400">0</span>
                    </div>
                </div>
            </div>

            <!-- Level Bar -->
            <div class="w-full mb-3">
                <div class="flex justify-between items-center mb-1">
                    <div class="flex items-center gap-2">
                        <span id="level-name" class="text-sm font-bold text-white">T·∫≠p s·ª±</span>
                        <span id="level-idx" class="text-[10px] text-gray-400">Lv 1/5</span>
                    </div>
                    <span id="level-progress-text" class="text-[10px] text-gray-400">0 / 500,000</span>
                </div>
                <div class="w-full h-3 bg-[#2d2d3e] rounded-full border border-[#3d3d52] overflow-hidden">
                    <div id="level-progress-bar" class="h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-out" style="width: 0%"></div>
                </div>
            </div>

        </div>
        <!-- ================= END HEADER WRAPPER ================= -->

        <!-- TAB: EXCHANGE -->
        <div id="tab-exchange" class="tab-content active px-4 pb-32 overflow-y-auto relative">
            <div class="flex w-full justify-between items-stretch mb-4 gap-2 z-20 relative">
                <div class="flex-1 bg-[#2d2d3e]/90 backdrop-blur p-2 rounded-xl border border-[#3d3d52] flex flex-col items-center justify-center">
                    <span class="text-[10px] text-gray-400 uppercase font-bold mb-1">Chuy·ªÉn ƒë·ªïi</span>
                    <div class="flex items-center gap-1.5">
                        <i data-lucide="plane" class="w-4 h-4 text-blue-400"></i>
                        <span id="tap-value" class="font-bold text-white text-sm">+1</span>
                    </div>
                </div>
                <div class="flex-1 bg-[#2d2d3e]/90 backdrop-blur p-2 rounded-xl border border-[#3d3d52] flex flex-col items-center justify-center">
                    <span class="text-[10px] text-gray-400 uppercase font-bold mb-1">ƒê·∫ßu t∆∞ ƒëang ch·∫°y</span>
                    <div class="flex items-center gap-2">
                        <i data-lucide="briefcase" class="w-4 h-4 text-green-400"></i>
                        <div class="flex flex-col items-start leading-none">
                            <span id="active-investments" class="font-bold text-white text-xs">0 g√≥i</span>
                            <span id="pending-return" class="text-[10px] text-green-400">+0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col items-center mb-4 z-20 relative">
                <div class="flex items-center gap-3 transition-transform duration-300" id="balance-container">
                    <div class="w-10 h-10 rounded-full bg-yellow-500 flex items-center justify-center text-2xl shadow-lg border-2 border-yellow-300">üí∞</div>
                    <h1 id="balance-display" class="text-4xl font-black text-white tracking-wider drop-shadow-lg">0</h1>
                </div>
            </div>

            <div id="game-container" class="relative w-full aspect-[4/3] mx-auto rounded-2xl overflow-hidden shadow-2xl border-4 border-[#2d2d3e] mb-4 bg-gray-900 select-none cursor-pointer flex-shrink-0">
                <!-- N·ªôi dung game -->
            </div>

            <div class="w-full max-w-[340px] mx-auto z-20 relative mt-auto">
                <div class="flex items-center justify-between mb-3 px-2">
                    <div class="flex items-center gap-2 bg-black/40 px-3 py-2 rounded-full border border-white/10 w-full relative">
                        <i data-lucide="zap" class="w-5 h-5 text-yellow-400 fill-current"></i>
                        <span class="font-bold text-sm flex-1"><span id="energy-display">1000</span> <span class="text-gray-400">/ <span id="max-energy-display">1000</span></span></span>
                        
                        <button onclick="openModal('modal-boost')" class="flex items-center gap-1 px-3 py-1 rounded-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg border border-indigo-400 hover:scale-105 active:scale-95 transition-transform">
                            <i data-lucide="rocket" class="w-4 h-4"></i>
                            <span class="text-xs font-bold">N√¢ng C·∫•p</span>
                        </button>
                    </div>
                </div>

                <button
                    id="main-action-btn"
                    data-state="idle"
                    class="w-full py-4 rounded-2xl font-black text-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 uppercase tracking-wide border-b-4 bg-gradient-to-b from-blue-500 to-blue-600 border-blue-800 text-white">

                    <i data-lucide="plane" class="w-6 h-6"></i>
                    <span class="btn-text">C·∫§T C√ÅNH</span>

                </button>

            </div>
        </div>

        <!-- TAB: MINE -->
        <div id="tab-mine" class="tab-content px-4 pb-32 overflow-y-auto relative">
            <div class="bg-[#2d2d3e] rounded-2xl p-4 mb-6 border border-[#3d3d52] mt-4 shadow-lg">
                <div class="flex justify-between items-center mb-2">
                    <div class="text-gray-300 text-sm font-medium">Danh m·ª•c ƒë·∫ßu t∆∞</div>
                    <div class="bg-blue-900/50 px-2 py-1 rounded text-xs text-blue-300 font-bold border border-blue-800" id="mine-active-count">0 g√≥i</div>
                </div>
                <div class="flex items-end gap-2">
                    <div class="text-3xl font-black text-green-400 drop-shadow-md" id="mine-pending-return">+0</div>
                    <span class="text-xs text-gray-400 mb-1.5">s·∫Øp nh·∫≠n v·ªÅ</span>
                </div>
            </div>
            <div id="investment-list" class="grid grid-cols-2 gap-3 pb-8"></div>
        </div>

        <!-- TAB: QUESTS -->
        <div id="tab-quests" class="tab-content px-4 pb-32 overflow-y-auto relative">
            <div class="bg-[#2d2d3e] rounded-2xl p-6 mb-6 border border-[#3d3d52] text-center mt-4">
                <div class="w-16 h-16 bg-blue-900/50 rounded-full flex items-center justify-center mx-auto mb-3 border border-blue-700 shadow-[0_0_20px_rgba(37,99,235,0.3)]">
                    <i data-lucide="clipboard-list" class="w-8 h-8 text-blue-400"></i>
                </div>
                <h2 class="text-xl font-bold text-white">Nhi·ªám V·ª• Ki·∫øm Ti·ªÅn</h2>
            </div>
            <div class="mb-6">
                <h3 class="font-bold text-white flex items-center gap-2 mb-3 px-1"><i data-lucide="calendar" class="w-4 h-4 text-green-400"></i> ƒêi·ªÉm danh h√†ng ng√†y</h3>
                <div id="daily-checkin-list" class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide"></div>
            </div>
            <div class="space-y-3">
                <h3 class="font-bold text-white px-1 mb-2">Danh s√°ch nhi·ªám v·ª•</h3>
                <div id="tasks-list" class="space-y-3"></div>
            </div>
        </div>

        <!-- TAB: FRIENDS -->
        <div id="tab-friends" class="tab-content px-4 pb-32 overflow-y-auto relative">
            <div class="text-center mb-6 pt-4">
                <h2 class="text-2xl font-bold text-white mb-2">M·ªùi b·∫°n b√® nh·∫≠n th∆∞·ªüng!</h2>
                <p class="text-gray-400 text-xs">B·∫°n v√† b·∫°n b√® s·∫Ω nh·∫≠n ƒë∆∞·ª£c ti·ªÅn th∆∞·ªüng</p>
            </div>
            <div class="space-y-3 mb-6">
                <div class="bg-[#2d2d3e] p-4 rounded-2xl flex items-center gap-4 border border-[#3d3d52]">
                    <div class="w-12 h-12 bg-blue-900/30 rounded-full flex items-center justify-center flex-shrink-0"><i data-lucide="users" class="w-6 h-6 text-blue-400"></i></div>
                    <div class="text-left flex-1">
                        <div class="font-bold text-white text-sm">M·ªùi b·∫°n b√®</div>
                        <div class="flex items-center gap-1 mt-1 text-xs"><span class="text-yellow-500">‚óè</span> <span class="text-yellow-400 font-bold">+100,000</span></div>
                    </div>
                </div>
                <div class="bg-[#2d2d3e] p-4 rounded-2xl flex items-center gap-4 border border-[#3d3d52]">
                    <div class="w-12 h-12 bg-purple-900/30 rounded-full flex items-center justify-center flex-shrink-0"><i data-lucide="zap" class="w-6 h-6 text-purple-400"></i></div>
                    <div class="text-left flex-1">
                        <div class="font-bold text-white text-sm">B·∫°n b√® c√≥ Premium</div>
                        <div class="flex items-center gap-1 mt-1 text-xs"><span class="text-yellow-500">‚óè</span> <span class="text-yellow-400 font-bold">+150,000</span></div>
                    </div>
                </div>
            </div>
            <div class="mb-20">
                <h3 class="font-bold text-white mb-3 px-1">Danh s√°ch b·∫°n b√® (<span id="friend-count">0</span>)</h3>
                <div id="friend-list-container" class="space-y-2"></div>
            </div>
            <div class="fixed bottom-24 left-1/2 -translate-x-1/2 w-full max-w-md px-4 flex gap-3 z-30">
                <button onclick="copyInviteLink()" class="flex-1 py-3.5 bg-blue-600 hover:bg-blue-500 rounded-xl text-white font-bold flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-all">
                    M·ªùi b·∫°n b√® <i data-lucide="users" class="w-5 h-5"></i>
                </button>
                <button onclick="copyInviteLink()" class="w-14 bg-blue-900/80 hover:bg-blue-800 rounded-xl text-white flex items-center justify-center shadow-lg active:scale-95 transition-all border border-blue-500/30">
                    <i data-lucide="copy" class="w-6 h-6"></i>
                </button>
            </div>
        </div>

        <!-- TAB: WITHDRAW -->
        <div id="tab-withdraw" class="tab-content px-4 pb-32 overflow-y-auto relative">
            <div class="bg-[#2d2d3e] rounded-2xl p-6 mb-6 border border-[#3d3d52] flex flex-col items-center mt-4">
                <div class="w-20 h-20 bg-purple-900/30 rounded-full flex items-center justify-center mb-4 border border-purple-500/50">
                    <i data-lucide="wallet" class="w-10 h-10 text-purple-400"></i>
                </div>
                <h2 class="text-xl font-bold text-white">R√∫t Ti·ªÅn V·ªÅ T√†i Kho·∫£n</h2>
                <div class="flex items-center gap-2 mt-2 bg-black/40 px-4 py-2 rounded-lg border border-white/5">
                    <span class="text-gray-400 text-xs">S·ªë d∆∞ kh·∫£ d·ª•ng:</span>
                    <span class="text-yellow-500 text-sm">üí∞</span>
                    <span class="font-bold text-white" id="withdraw-balance">0</span>
                </div>
            </div>
            <div class="bg-[#1c1c1e] rounded-2xl p-5 border border-white/10 mb-6">
                <div class="space-y-4">
                    
                    <div class="relative">
                        <select id="bank-name" class="w-full bg-[#2c2c2e] text-white text-sm rounded-xl py-3 px-4 border border-white/5 focus:border-blue-500 outline-none appearance-none">
                            <option value="" disabled selected>Ch·ªçn ng√¢n h√†ng</option>
                            <option value="MB">MB Bank</option>
                            <option value="VCB">Vietcombank</option>
                            <option value="TCB">Techcombank</option>
                            <option value="ACB">ACB</option>
                            <option value="ICB">VietinBank</option>
                            <option value="BIDV">BIDV</option>
                            <option value="TPB">TPBank</option>
                            <option value="VPB">VPBank</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-gray-400">
                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                        </div>
                    </div>

                    <input type="number" id="account-number" placeholder="S·ªë T√†i Kho·∫£n" class="w-full bg-[#2c2c2e] text-white text-sm rounded-xl py-3 px-4 border border-white/5 focus:border-blue-500 outline-none">
                    <input type="text" id="account-holder" placeholder="T√™n Ch·ªß T√†i Kho·∫£n" class="w-full bg-[#2c2c2e] text-white text-sm rounded-xl py-3 px-4 border border-white/5 focus:border-blue-500 outline-none uppercase">
                    <div>
                        <input type="number" id="withdraw-amount" placeholder="S·ªë Xu Mu·ªën R√∫t" class="w-full bg-[#2c2c2e] text-white text-sm rounded-xl py-3 px-4 border border-white/5 focus:border-blue-500 outline-none">
                        <div class="text-right mt-1 text-[10px] text-gray-500" id="withdraw-rate">Quy ƒë·ªïi: 0 VNƒê</div>
                    </div>
                    <button id="withdraw-btn" onclick="submitWithdraw(this)" class="w-full py-3 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl font-bold text-white shadow-lg active:scale-95 transition-transform mt-2">G·ª≠i Y√™u C·∫ßu</button>
                </div>
            </div>
            <div class="mb-4">
                <h3 class="font-bold text-white flex items-center gap-2 mb-3 px-1"><i data-lucide="history" class="w-4 h-4 text-gray-400"></i> L·ªãch s·ª≠ r√∫t ti·ªÅn</h3>
                <div id="withdraw-history" class="space-y-2"></div>
            </div>
        </div>

        <!-- BOTTOM NAV -->
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-[95%] max-w-md bg-[#1a1a24]/95 backdrop-blur-xl rounded-2xl border border-white/10 p-2 grid grid-cols-5 gap-1 z-50 shadow-2xl">
            <button onclick="switchTab('exchange')" class="nav-btn active rounded-lg py-2 flex flex-col items-center justify-center gap-1" id="nav-exchange"><i data-lucide="plane" class="w-5 h-5"></i><span class="text-[9px]">Bay</span></button>
            <button onclick="switchTab('mine')" class="nav-btn rounded-lg py-2 flex flex-col items-center justify-center gap-1" id="nav-mine"><i data-lucide="pickaxe" class="w-5 h-5"></i><span class="text-[9px]">ƒê·∫ßu t∆∞</span></button>
            <button onclick="switchTab('quests')" class="nav-btn rounded-lg py-2 flex flex-col items-center justify-center gap-1" id="nav-quests"><i data-lucide="clipboard-list" class="w-5 h-5"></i><span class="text-[9px]">Nhi·ªám v·ª•</span></button>
            <button onclick="switchTab('friends')" class="nav-btn rounded-lg py-2 flex flex-col items-center justify-center gap-1" id="nav-friends"><i data-lucide="users" class="w-5 h-5"></i><span class="text-[9px]">ƒê·ªôi bay</span></button>
            <button onclick="switchTab('withdraw')" class="nav-btn rounded-lg py-2 flex flex-col items-center justify-center gap-1" id="nav-withdraw"><i data-lucide="wallet" class="w-5 h-5"></i><span class="text-[9px]">R√∫t ti·ªÅn</span></button>
        </div>
    </div>

    <!-- MODAL BOOST -->
    <div id="modal-boost" class="modal-overlay" onclick="closeModal('modal-boost')">
        <div class="w-full max-w-sm bg-[#1c1c1e] rounded-2xl p-5 border border-white/10 animate-zoom-in relative mx-4" onclick="event.stopPropagation()">
            <button class="absolute top-4 right-4 text-gray-400" onclick="closeModal('modal-boost')"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div class="text-center mb-6">
                <h2 class="text-xl font-bold text-yellow-400 flex items-center justify-center gap-2"><i data-lucide="rocket" class="w-6 h-6"></i> N√¢ng C·∫•p</h2>
                <p class="text-gray-400 text-xs mt-1">C·∫£i ti·∫øn k·ªπ thu·∫≠t ƒë·ªÉ bay xa h∆°n</p>
            </div>
            <div class="space-y-4" id="boost-list"></div>
        </div>
    </div>

    <!-- MODAL TASK -->
    <div id="modal-task" class="modal-overlay" onclick="closeModal('modal-task')">
        <div class="w-full max-w-sm bg-[#1c1c1e] rounded-2xl p-6 border border-white/10 animate-zoom-in relative mx-4" onclick="event.stopPropagation()">
            <button class="absolute top-4 right-4 text-gray-400" onclick="closeModal('modal-task')"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div class="flex flex-col items-center text-center mb-6 pt-2">
                <div class="w-20 h-20 bg-[#2c2c2e] rounded-2xl flex items-center justify-center mb-4 text-4xl shadow-lg border border-white/5" id="task-icon">üì∫</div>
                <h2 class="text-xl font-bold text-white mb-2" id="task-name">T√™n nhi·ªám v·ª•</h2>
                <div class="flex items-center gap-1 bg-yellow-900/30 px-3 py-1 rounded-full border border-yellow-700/50">
                    <span class="text-lg">üí∞</span>
                    <span class="text-xl font-black text-yellow-400" id="task-reward">+0</span>
                </div>
            </div>
            <button onclick="doTaskAction()" class="w-full py-3 mb-3 bg-blue-600 hover:bg-blue-500 rounded-xl text-white font-bold flex items-center justify-center gap-2 active:scale-95 transition-all" id="task-btn-action">
                Tham gia ngay <i data-lucide="chevron-right" class="w-4 h-4"></i>
            </button>
            <button onclick="checkTaskAction()" class="w-full py-3 bg-green-600 hover:bg-green-500 rounded-xl text-white font-bold flex items-center justify-center gap-2 active:scale-95 transition-all" id="task-btn-check">
                Ki·ªÉm tra
            </button>
        </div>
    </div>

    <!-- ========================================= -->
    <!-- PH·∫¶N 3: JAVASCRIPT (LOGIC) -->
    <!-- ========================================= -->
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="app.js"></script>
    <script>
        // H√†m ph·ª• ƒë·ªÉ t·∫Øt loading n·∫øu app.js b·ªã l·ªói ho·∫∑c t·∫£i ch·∫≠m
        window.addEventListener('load', () => {
           // M·∫∑c ƒë·ªãnh app.js s·∫Ω lo vi·ªác n√†y, nh∆∞ng th√™m v√†o cho ch·∫Øc
           const loader = document.getElementById('loading-screen');
           if(loader && !loader.classList.contains('hidden')) {
               // ƒê·ª£i 1 ch√∫t r·ªìi t·∫Øt n·∫øu ch∆∞a t·∫Øt
               setTimeout(() => {
                   if(document.body.innerHTML.length > 500) { // Check xem ƒë√£ render ch∆∞a
                       loader.style.opacity = '0';
                       setTimeout(() => loader.remove(), 500);
                   }
               }, 2000); 
           }
        });
    </script>
</body>
</html>
